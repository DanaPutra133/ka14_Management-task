datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}


model TugasMhs {
  id         Int      @id @default(autoincrement())
  matakuliah String
  Namatugas  String
  UrlGambar  String?
  Noted      String?
  deadline   DateTime
  kelompok   Boolean  @default(false)
  vclass     Boolean  @default(false)
  praktikum  Boolean  @default(false)
  ilab       Boolean  @default(false)
  Mandiri    Boolean  @default(false)
  createdBy  String?
  updatedBy  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  userProgress UserTaskProgress[]
}

model TugasDosen {
  id         Int      @id @default(autoincrement())
  matakuliah String
  TanggalMasuk DateTime
  Kelas      String
  Jam        String
  LinkGmeet  String?
  vclass     Boolean  @default(false)
  Gmeet      Boolean  @default(false)
  offline    Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model PushSubscription {
  id        Int      @id @default(autoincrement())
  endpoint  String   @unique
  keysAuth  String
  keysP256dh String
  createdAt DateTime @default(now())
}

model User {
  npm        String   @id 
  pin        String  
  email      String
  isApproved Boolean  @default(false) 
  isEditor   Boolean  @default(false)
  lastLogin  DateTime?
  createdAt  DateTime @default(now())
  
  // Relasi ke progres tugas
  taskProgress UserTaskProgress[]
}

model UserTaskProgress {
  id         Int      @id @default(autoincrement())
  userNpm    String
  tugasId    Int
  isCompleted Boolean @default(false) 
  catatan    String? 
  
  user       User     @relation(fields: [userNpm], references: [npm])
  tugas      TugasMhs @relation(fields: [tugasId], references: [id], onDelete: Cascade)

  @@unique([userNpm, tugasId]) 
}